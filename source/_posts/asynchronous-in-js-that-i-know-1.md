---
title: 我所了解的异步JavaScript(1)
date: 2018-04-23 20:00:33
tag: [异步编程, 前端]
categories: 技术
---

最近想重新整理一下自己的前端技术知识，归纳并总结成笔记，不然搬了一段时间的砖没点积累岂不是白干？
<!-- more -->

在前端方面，我目前技术重心在JavaScript，CSS次之，最后就是HTML。

所以我打算从JavaScript开始整理，既然要说JavaScript，`异步`则是一个重点要关注的地方。

我对于`异步`还是有所了解的，大致说来有以下几点

+ setTimeout是浏览器提供的一个`异步`API，通过这个函数，使用者提供一个回调函数fn，和一个时间time，给予使用者一种“延迟” time 后执行fn的假象，实际上什么时候执行fn并不是由time来决定，而是要靠`任务队列`来决定的

+ `回调函数`是目前为止在JavaScript中表达异步和管理异步最常用的方式。但是有不好的地方，容易造成回调地狱

好了，大概这么多，废话少说，下面进入正题.

### 单线程和异步的关系

JavaScript引擎是基于单线程事件循环的概念构建的，同一时刻只允许一个代码块在执行。在浏览器中的表现形式为，只有一个js执行线程，所以执行的时候，由上往下依次执行js代码。

js执行线程在执行某些耗时的js代码的时候，通常会在浏览器内部注册一个回调函数，当这部分耗时的js代码有结果的时候，浏览器会将回调函数放入异步队列的队尾等待执行。

上面这种执行代码不是立刻就有结果的现象，就是`异步`。

针对这种耗时操作的场景，所以就用了`异步`。如果不使用`异步`，那就会出现整个浏览器的界面会因为某些耗时操作而卡顿，让用户无法操作其他功能。

在理解JavaScript中的`异步`的时候，要充分认识到异步代码是不会立刻有执行的结果的。

比如下面的代码:

```js
for (var i = 0; i < 5 ; i++) {
  setTimeout(function () {
    console.log(i);
  },1000)
}

// 实际结果 连续输出5个5
```
这段代码原本的用意是想间隔一秒输出i的值，可实际上输出了5个5。

js执行引擎执行到setTimeout的时候，会把setTimeout这部分代码放入到异步队列里面，然后继续执行后面的代码，等到后续的代码都执行完的时候，再轮询执行异步队列的函数。

当执行到console.log(i)的时候，for循环早就执行完了，在for循环里面使用var定义的变量i在循环结束的时候会变成全局变量，当函数里面的console.log(i)再次访问i的时候，就会连续输出5。连续5个函数，自然就是连续输出5个5。

#### 常见的异步API

+ XMLHttpRequest

+ postMessage

+ requestAnimationFrame

+ setTimeout && setInterval

+ 等等







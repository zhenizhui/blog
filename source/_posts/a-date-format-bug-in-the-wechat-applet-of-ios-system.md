---
title: 小程序日期时间在iOS系统上显示为NaN问题
date: 2020-08-19 23:00:33
tag: [微信小程序, 坑]
categories: 前端
---

我遇到一个广为人知的 bug。

<!-- more -->

### Bug 在哪里

昨天 18 号上线了一个直播的聚合列表，方便用户从 3 个不同的入口进入到同一个直播列表观看直播。然后 19 号上午产品同学在使用小程序的时候发现一个问题，然后截了一张图扔了过来。

![小程序日期时间在iOS系统上显示为NaN问题](bug.jpg)

可以明显地看到本该出现"月份-日期"的地方出现了"NaN-NaN"的错误。

我一开始对这个情况也是有点懵的，因为我当时也有在测试，我在我的安卓手机和微信小程序的 IDE 里面，也没能复现这个 bug，而且后端的接口数据也没有问题。对于这个日期，后端给出的字段以及值如下

```js
{
  time: "2020-08-01 14:00:00"
}
```

在代码中，我很自然的就直接把 time 这个字符串扔进`new Date()`的构造函数里面，然后通过 Date 对象的函数获取月份和日期。

哪里出问题了？

我到产品的工位具体查看是什么情况，就看到产品同学自己用的是 iPhone。然后我就思考：会不会是安卓和 iOS 这两个平台对`Date()`对象的处理有 API 兼容性的问题？

搜了一下，果然如此，而且这个问题很多人都经历过，很多人都知道。

### Bug 如何处理

其实原因就是** iOS 系统不支持 2020-08-01 这样格式的时间导致出现的这个问题，iOS 只识别 2020/08/01 这样的格式。**

所以我们在用这种格式`"2020-08-01 14:00:00"`的时间的时候需要把 `-` 替换为 `/`。

```js
const time = "2020-08-01 14:00:00"

const newTimeStr = time.replace(/-/g, "/")

const date = new Date(newTimeStr)
```

经过上面这样处理，date 对象就正常了。

### 如何避免同样的问题

- 让后端不要给这种格式的时间，让后端直接给时间戳

- 使用专业的时间处理库。比如[momentjs](https://momentjs.com/)。
